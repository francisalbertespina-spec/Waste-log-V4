<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Hazardous Waste Log HDJV</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link href="style.css" rel="stylesheet" type="text/css"> 
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
  
<body>
  <div class="app-container">
    <div class="header">
      <img src="logo.png" alt="Logo" class="logo" onerror="this.style.display='none'">
      <h1>Hazardous Waste Log</h1>
      <p>HDJV Environmental Management</p>
      <div id="user-info" class="user-info" style="display: none;">
        <div class="user-badge">
          <span id="user-name"></span>
          <span id="user-role-badge" class="role-badge"></span>
        </div>
        
        <!-- Admin Mode Toggle (visible only to admins) -->
        <div id="mode-toggle" class="mode-toggle admin-only" style="display: none;">
          <span class="mode-label" id="mode-label-user">User</span>
          <label class="toggle-switch">
            <input type="checkbox" id="admin-mode-toggle" onchange="toggleAdminMode()">
            <span class="toggle-slider"></span>
          </label>
          <span class="mode-label" id="mode-label-admin">Admin</span>
        </div>
      </div>
    </div>

    <div class="content">
      <!-- Login Section -->
      <div id="login-section" class="section active">
        <h2 style="text-align: center; margin-bottom: 20px; color: #333;">Welcome</h2>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
          Please sign in with your authorized Google account to continue
        </p>
        
        <div id="loginWrapper">
          <div id="buttonDiv" style="display:flex; justify-content:center;"></div>
        
          <div id="loginLoadingUI" class="login-loading-ui">
            <div class="login-spinner"></div>
            <p>Signing you in‚Ä¶</p>
          </div>
        </div>
      </div>
      
      <!-- Package Selection -->
      <div id="package-section" class="section">
        <h2 style="margin-bottom: 10px; color: #333;">Select Package</h2>
        <p style="color: #666; margin-bottom: 20px;">Choose the package you want to work with</p>
        
        <div class="package-grid">
          <div class="package-card" onclick="selectPackage('P4', this)">
            <div class="icon">üì¶</div>
            <div class="name">Package 4</div>
          </div>
          <div class="package-card" onclick="selectPackage('P5', this)">
            <div class="icon">üì¶</div>
            <div class="name">Package 5</div>
          </div>
          <div class="package-card" onclick="selectPackage('P6', this)">
            <div class="icon">üì¶</div>
            <div class="name">Package 6</div>
          </div>
        </div>

        <button class="btn btn-primary" onclick="confirmPackage()">
          Continue
        </button>
        
        <button class="btn btn-secondary" onclick="logout()" style="margin-top: 10px;">
          Sign Out
        </button>
      </div>

      <!-- Menu Section -->
      <div id="menu-section" class="section">
        <button class="back-btn" onclick="backToPackage()">
          ‚Üê Back to Packages
        </button>
        
        <div class="breadcrumb">
          <span class="breadcrumb-item active" id="current-package"></span>
        </div>
      
        <h2 style="margin-bottom: 10px; color: #333;">What would you like to do?</h2>
        <p style="color: #666; margin-bottom: 25px;">Choose an action below</p>
      
        <div class="menu-grid">
          <div class="menu-btn" onclick="showLogForm()">
            <div class="icon">‚úèÔ∏è</div>
            <div class="text">
              <h3>Log New Entry</h3>
              <p>Record new waste disposal</p>
            </div>
            <div class="arrow">‚Üí</div>
          </div>
      
          <div class="menu-btn" onclick="showHistoryView()">
            <div class="icon">üìä</div>
            <div class="text">
              <h3>View Records</h3>
              <p>Browse past entries</p>
            </div>
            <div class="arrow">‚Üí</div>
          </div>
        </div>
        
        <button class="btn btn-secondary" onclick="backToPackage()" style="margin-top: 20px;">
          Change Package
        </button>
      </div>

      <!-- Form Section -->
      <div id="form-section" class="section">
        <button class="back-btn" onclick="showMenu()">
          ‚Üê Back to Menu
        </button>
        
        <div class="breadcrumb">
          <span class="breadcrumb-item" onclick="backToPackage()">Packages</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item" onclick="showMenu()" id="form-package"></span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item active">New Entry</span>
        </div>

        <h2 style="margin-bottom: 20px; color: #333;">New Entry</h2>

        <div class="form-group" id="date-group">
          <label>Date</label>
          <input type="date" id="date">
          <div class="error-msg">Please select a date</div>
        </div>

        <div class="form-group" id="volume-group">
          <label>Volume (kg)</label>
          <input type="number" step="0.00001" id="volume" placeholder="0.00000">
          <div class="error-msg">Please enter a volume</div>
        </div>

        <div class="form-group" id="waste-group">
          <label>Waste Name</label>
          <select id="waste">
            <option value="">-- Select Waste Type --</option>
            <option value="Used Oil">Used Oil</option>
            <option value="Pathological and Infectious Waste">Pathological and Infectious Waste</option>
            <option value="Lead Compounds">Lead Compounds</option>
            <option value="Oil Contaminated Materials">Oil Contaminated Materials</option>
            <option value="Grease Waste">Grease Waste</option>
            <option value="Waste Electrical and Electronic Equipment">Waste Electrical and Electronic Equipment</option>
            <option value="Mercury and Mercury Compounds">Mercury and Mercury Compounds</option>
            <option value="Containers Previously containing toxic chemical substances">Containers Previously containing toxic chemical substances</option>
          </select>
          <div class="error-msg">Please select a waste type</div>
        </div>

        <div class="form-group" id="photo-group">
          <label>Photo Proof</label>
          <div class="photo-upload" onclick="document.getElementById('photo').click()">
            <input type="file" id="photo" accept="image/*" capture="environment" onchange="previewImage(event)">
            <div class="placeholder">
              <div class="icon">üì∑</div>
              <p><strong>Tap to capture photo</strong></p>
              <p style="font-size: 0.85rem; color: #999; margin-top: 5px;">Required for verification</p>
            </div>
          </div>
          <div class="error-msg">Please upload a photo</div>
        </div>

        <div class="btn-group">
          <button id="submitBtn" class="btn btn-primary" onclick="addEntry()">
            Submit Entry
          </button>
        </div>
      </div>

      <!-- History Section -->
      <div id="history-section" class="section">
        <button class="back-btn" onclick="showMenu()">
          ‚Üê Back to Menu
        </button>
        
        <div class="breadcrumb">
          <span class="breadcrumb-item" onclick="backToPackage()">Packages</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item" onclick="showMenu()" id="history-package"></span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item active">View Records</span>
        </div>

        <h2 style="margin-bottom: 20px; color: #333;">View Records</h2>

        <div class="date-range">
          <div class="form-group">
            <label>From</label>
            <input type="date" id="fromDate">
          </div>
          <div class="form-group">
            <label>To</label>
            <input type="date" id="toDate">
          </div>
        </div>

        <div class="history-actions">
          <button class="btn btn-primary" onclick="loadHistory()">
            Load Entries
          </button>
        
          <button id="exportBtn" class="btn btn-secondary" onclick="exportExcel()">
            Export to Excel (XLSX)
          </button>
        </div>

        <div id="loading" style="display:none;">
          <div class="spinner"></div>
          <p style="text-align: center; color: #666;">Loading data...</p>
        </div>

        <div class="table-wrapper" id="table-container" style="display:none;">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>kg</th>
                <th>Waste</th>
                <th>User</th>
                <th>Photo</th>
              </tr>
            </thead>
            <tbody id="table-body"></tbody>
          </table>
        </div>

        <div id="empty-state" class="empty-state">
          <div class="icon">üìã</div>
          <p><strong>No records to display</strong></p>
          <p style="font-size: 0.9rem;">Select a date range and click "Load Entries"</p>
        </div>
      </div>
      
      <!-- Admin Dashboard -->
      <div id="admin-dashboard" class="section admin-only">
        <div class="admin-dashboard-header">
          <h2>üõ°Ô∏è Admin Dashboard</h2>
          <p>Manage users and monitor system activity</p>
        </div>

        <div class="admin-menu-grid">
          <div class="admin-menu-card" onclick="showUserManagement()">
            <div class="admin-menu-icon">üë•</div>
            <h3>User Management</h3>
            <p>Approve or reject user access</p>
            <div class="arrow">‚Üí</div>
          </div>
          
          <div class="admin-menu-card" onclick="showRequestLogs()">
            <div class="admin-menu-icon">üìù</div>
            <h3>Request Logs</h3>
            <p>View system activity logs</p>
            <div class="arrow">‚Üí</div>
          </div>
        </div>
      </div>

      <!-- User Management Section -->
      <div id="user-management-section" class="section admin-only">
        <button class="back-btn" onclick="backToAdminDashboard()">‚Üê Back to Admin Dashboard</button>
        
        <div class="breadcrumb">
          <span class="breadcrumb-item" onclick="backToAdminDashboard()">Admin Dashboard</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item active">User Management</span>
        </div>

        <div class="admin-card">
          <div class="admin-header">
            <h2>üë• User Management</h2>
            <p>Approve or reject user access requests</p>
          </div>

          <div class="admin-block">
            <div class="admin-block-header">
              <h3>All Users</h3>
              <button class="btn btn-sm" onclick="loadUsers()">Refresh</button>
            </div>
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Email</th>
                  <th>Status</th>
                  <th>Role</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="usersTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Request Logs Section -->
      <div id="request-logs-section" class="section admin-only">
        <button class="back-btn" onclick="backToAdminDashboard()">‚Üê Back to Admin Dashboard</button>
        
        <div class="breadcrumb">
          <span class="breadcrumb-item" onclick="backToAdminDashboard()">Admin Dashboard</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item active">Request Logs</span>
        </div>

        <div class="admin-card">
          <div class="admin-header">
            <h2>üìù Request Logs</h2>
            <p>System activity and request history</p>
          </div>

          <div class="admin-block">
            <div class="admin-block-header">
              <h3>Recent Requests</h3>
              <button class="btn btn-sm" onclick="loadRequests()">Refresh</button>
            </div>

            <table class="admin-table">
              <thead>
                <tr>
                  <th>Request ID</th>
                  <th>Time</th>
                </tr>
              </thead>
              <tbody id="requestsTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
      
      <!-- Old Admin Section - Remove this -->
      <div id="admin-section" class="section admin-only" style="display: none;">
        <button class="back-btn" onclick="showMenu()">‚Üê Back to Menu</button>
      
    </div>

    <div class="footer">
      Created by <strong>E. Francis Albert</strong>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <h3>Entry Submitted!</h3>
      <p>Your waste entry has been successfully logged to the cloud.</p>
      <button class="btn btn-primary" onclick="closeModal()">OK</button>
    </div>
  </div>

  <!-- Image Preview Modal -->
  <div id="imageModal" class="image-modal" onclick="closeImageModal()">
    <img id="modalImage" alt="Preview" onclick="event.stopPropagation()">
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="script.js"></script>
</body>
</html>
